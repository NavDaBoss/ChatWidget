(()=>{var B=Object.defineProperty,W=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var A=(e,o,i)=>o in e?B(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,y=(e,o)=>{for(var i in o||(o={}))N.call(o,i)&&A(e,i,o[i]);if(w)for(var i of w(o))P.call(o,i)&&A(e,i,o[i]);return e},v=(e,o)=>W(e,$(o));var{widget:I}=figma,{AutoLayout:d,Text:a,useSyncedState:l,Input:V,Frame:E}=I;function j(){console.log("ChatWidget rendered2");let[e,o]=l("newMessage",""),[i,p]=l("replyToId",null),[s,u]=l("messages",[]),[h,m]=l("userName","Anonymous"),[g,c]=l("inputPlaceholder","Type a message..."),[D,f]=l("inputActive",!1),[O,Y]=l("upvotedUserIds",[]);console.log("Current messages:",s);let q=()=>figma.widget.h(E,{width:"fill-parent",height:500,overflow:"scroll"},figma.widget.h(d,{direction:"vertical",spacing:-100,padding:4},F())),G=()=>{figma.currentUser&&figma.currentUser.name&&m(figma.currentUser.name)};function T(r){u(s.map(t=>t.id===r?{id:t.id,parentId:t.parentId,text:"*This message was deleted*",sender:void 0,timestamp:void 0,isDeleted:!0,upvotes:0,downvotes:0}:t))}let M=()=>{if(console.log("handleAddMessage called"),e.trim()!==""){let r=Date.now(),t=new Date(r),n=t.getHours(),b=t.getMinutes(),L=b<10?"0"+b:b.toString(),U=n>=12?"PM":"AM",k=`${n%12||12}:${L} ${U}`,C=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:h,z={id:r,parentId:i,text:e.trim(),sender:C,timestamp:k,upvotes:0,downvotes:0};u([...s,z]),o(""),p(null),c("Type a message..."),f(!0),setTimeout(()=>f(!1),2e3)}},R=r=>{p(r);let t=s.find(n=>n.id===r);t&&(o(""),c(`Reply to "${t.text}":`)),f(!0),setTimeout(()=>f(!1),2e3)},x=(r,t)=>{u(s.map(n=>n.id===r?v(y({},n),{upvotes:t==="upvote"?n.upvotes+1:n.upvotes}):n))},S=(r,t)=>{u(s.map(n=>n.id===r?v(y({},n),{downvotes:t==="downvote"?n.downvotes+1:n.downvotes}):n))},F=(r=null)=>s.filter(t=>t.parentId===r).map(t=>figma.widget.h(H,{key:t.id,message:t,onReply:()=>R(t.id),onDelete:()=>T(t.id),replyChain:F(t.id),replyToId:i,upVote:()=>x(t.id,"upvote"),downVote:()=>S(t.id,"downvote")}));return figma.widget.h(d,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(d,{direction:"horizontal",spacing:100,padding:8,stroke:D?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(V,{placeholder:g,value:e,onTextEditEnd:r=>o(r.characters)}),figma.widget.h(d,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:M},figma.widget.h(a,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(d,{direction:"vertical",spacing:-100,padding:4},F()))}function H({message:e,onReply:o,onDelete:i,replyChain:p,replyToId:s,upVote:u,downVote:h}){console.log("MessageBubble called with message:",e,"and replyToId:",s);let m=e.parentId!==null,g=s===e.id;console.log(`Message ID: ${e.id}, ReplyTo ID: ${s}, Is Being Replied To: ${g}`);let c={fill:g?"#007AFF":"#FFFFFF",color:g?"#FFFFFF":"#000000"};return console.log(c),figma.widget.h(d,{direction:"vertical",padding:{top:1,bottom:10,left:m?32:8,right:8},stroke:"#D3D3D3",strokeWidth:1,cornerRadius:4,fill:c.fill},!e.isDeleted&&figma.widget.h(d,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:150,padding:{top:4,bottom:0,left:4,right:4}},e.sender&&figma.widget.h(a,{fontSize:14},e.sender,":"),e.timestamp&&figma.widget.h(a,{fontSize:12},e.timestamp)),figma.widget.h(d,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},fill:c.fill},figma.widget.h(a,null,e.isDeleted?e.text="*This message was deleted*":e.text)),!e.isDeleted&&figma.widget.h(d,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},spacing:8},figma.widget.h(d,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:o},figma.widget.h(a,{fontSize:14,fill:"#FFFFFF"},"Reply")),figma.widget.h(d,{fill:"#00A79D",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:u},figma.widget.h(a,{fontSize:14,fill:"#FFFFFF"},"Upvote (",e.upvotes,")")),figma.widget.h(d,{fill:"#FF5A5F",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:h},figma.widget.h(a,{fontSize:14,fill:"#FFFFFF"},"Downvote (",e.downvotes,")")),figma.widget.h(d,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:i},figma.widget.h(a,{fontSize:14,fill:"#FFFFFF"},"Delete"))),p&&figma.widget.h(d,{direction:"vertical",spacing:30},p))}I.register(j);})();
