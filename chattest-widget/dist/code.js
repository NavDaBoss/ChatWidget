(()=>{var P=Object.defineProperty,V=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var T=(e,n,i)=>n in e?P(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,b=(e,n)=>{for(var i in n||(n={}))j.call(n,i)&&T(e,i,n[i]);if(D)for(var i of D(n))H.call(n,i)&&T(e,i,n[i]);return e},v=(e,n)=>V(e,E(n));var{widget:U}=figma,{AutoLayout:s,Text:l,useSyncedState:u,Input:O,Frame:Y}=U;function q(){console.log("ChatWidget rendered2");let[e,n]=u("newMessage",""),[i,g]=u("replyToId",null),[a,c]=u("messages",[]),[m,F]=u("userName","Anonymous"),[f,p]=u("inputPlaceholder","Type a message..."),[I,h]=u("inputActive",!1),[w,M]=u("upvotedUsers",[]),[A,R]=u("downvotedUsers",[]);console.log("Current messages:",a);let J=()=>figma.widget.h(Y,{width:"fill-parent",height:500,overflow:"scroll"},figma.widget.h(s,{direction:"vertical",spacing:-100,padding:4},y())),K=()=>{figma.currentUser&&figma.currentUser.name&&F(figma.currentUser.name)};function x(r){c(a.map(t=>t.id===r?{id:t.id,parentId:t.parentId,text:"*This message was deleted*",sender:void 0,timestamp:void 0,isDeleted:!0,upvotes:0,downvotes:0}:t))}let S=()=>{if(console.log("handleAddMessage called"),e.trim()!==""){let r=Date.now(),t=new Date(r),d=t.getHours(),o=t.getMinutes(),z=o<10?"0"+o:o.toString(),B=d>=12?"PM":"AM",W=`${d%12||12}:${z} ${B}`,$=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:m,N={id:r,parentId:i,text:e.trim(),sender:$,timestamp:W,upvotes:0,downvotes:0};c([...a,N]),n(""),g(null),p("Type a message..."),h(!0),setTimeout(()=>h(!1),2e3)}},L=r=>{g(r);let t=a.find(d=>d.id===r);t&&(n(""),p(`Reply to "${t.text}":`)),h(!0),setTimeout(()=>h(!1),2e3)},k=(r,t)=>{let d=figma.currentUser;d&&!w.some(o=>o.id===d.id)?(c(a.map(o=>o.id===r?v(b({},o),{upvotes:t==="upvote"?o.upvotes+1:o.upvotes}):o)),M([...w,d])):console.log("You already upvoted!")},C=(r,t)=>{let d=figma.currentUser;d&&!A.some(o=>o.id===d.id)?(c(a.map(o=>o.id===r?v(b({},o),{downvotes:t==="downvote"?o.downvotes+1:o.downvotes}):o)),R([...A,d])):console.log("You can only downvote once!")},y=(r=null)=>a.filter(t=>t.parentId===r).map(t=>figma.widget.h(G,{key:t.id,message:t,onReply:()=>L(t.id),onDelete:()=>x(t.id),replyChain:y(t.id),replyToId:i,upVote:()=>k(t.id,"upvote"),downVote:()=>C(t.id,"downvote")}));return figma.widget.h(s,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(s,{direction:"horizontal",spacing:100,padding:8,stroke:I?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(O,{placeholder:f,value:e,onTextEditEnd:r=>n(r.characters)}),figma.widget.h(s,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:S},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(s,{direction:"vertical",spacing:-100,padding:4},y()))}function G({message:e,onReply:n,onDelete:i,replyChain:g,replyToId:a,upVote:c,downVote:m}){console.log("MessageBubble called with message:",e,"and replyToId:",a);let F=e.parentId!==null,f=a===e.id;console.log(`Message ID: ${e.id}, ReplyTo ID: ${a}, Is Being Replied To: ${f}`);let p={fill:f?"#007AFF":"#FFFFFF",color:f?"#FFFFFF":"#000000"};return console.log(p),figma.widget.h(s,{direction:"vertical",padding:{top:1,bottom:10,left:F?32:8,right:8},stroke:"#D3D3D3",strokeWidth:1,cornerRadius:4,fill:p.fill},!e.isDeleted&&figma.widget.h(s,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:150,padding:{top:4,bottom:0,left:4,right:4}},e.sender&&figma.widget.h(l,{fontSize:14},e.sender,":"),e.timestamp&&figma.widget.h(l,{fontSize:12},e.timestamp)),figma.widget.h(s,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},fill:p.fill},figma.widget.h(l,null,e.isDeleted?e.text="*This message was deleted*":e.text)),!e.isDeleted&&figma.widget.h(s,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},spacing:8},figma.widget.h(s,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:n},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Reply")),figma.widget.h(s,{fill:"#00A79D",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:c},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Upvote (",e.upvotes,")")),figma.widget.h(s,{fill:"#FF5A5F",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:m},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Downvote (",e.downvotes,")")),figma.widget.h(s,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:i},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Delete"))),g&&figma.widget.h(s,{direction:"vertical",spacing:30},g))}U.register(q);})();
